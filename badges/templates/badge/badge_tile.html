{% load i18n %}
{% load open_badges_tags %}

<li class="p2pu-badge span2
    {% if earned == 'True' and user.username == request.session.user.username %}p2pu-badge-long{% endif %}"
    data-next={{ next_page }}>
    <div class="overflow-handle">
        {% if can_delete_badge %}
            <a href="#" type="button" class="close" data-delete="p2pu-badge">Ã—</a>
            <div class="badge-delete-popover" style="display: none">
                <p>{% trans 'Sure you want to delete this nifty Badge?' %}</p>

                <div class="badge-delete-controls clearfix">
                    <a href="{% url badge_delete badge.id %}"
                       class="badge-delete-confirm btn btn-primary">{% trans 'Delete' %}</a>
                    <a href="" class="badge-delete-cancel btn">{% trans 'Cancel' %}</a>
                </div>
            </div>
        {% endif %}
        <a class="badge-image" href="
                {% if badge.publised %}
                    {% url badge_view badge.id %}
                {% else %}
                    {% url badge_preview badge.id %}
                {% endif %}">
            <img src="{{ badge.image.url }}"/>
        </a>

        <div class="badge-container">
            <a class="badge-title" href="{% if badge.publised %}{% url badge_view badge.id %}
                         {% else %}{% url badge_preview badge.id %}{% endif %}">
                <h4>{{ badge.title }}</h4>
            </a>

            <p class="badge-description">{{ badge.description }}</p>
        </div>
        {% if request.session.user.username == user.username and earned %}
            <div class="badge-controls clearfix">
                {% if badge.award_ob_state == 'NOT_PUBLISHED' %}
                    <a class="btn btn-mini btn-clementine pull-left ob-push-to-backpack"
                       data-assertion-url="{% assertion_url badge %}"
                       data-pushed-to-backpack-url="{% pushed_to_backpack_url badge %}">Add to Backpack</a>
                {% else %}
                    <a class="btn btn-mini disabled pull-left" href="">In backpack</a>
                {% endif %}
                <div class="badge-more-info-control pull-right">
                    <a href="http://backpack.openbadges.org/backpack" target="_blank"
                       class="badge-more-info">
                        <i class="icon-angle-right"></i>
                        more info
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
    <div class="badge-author-wrap">
        <span>
            {% trans 'Author' %}:
        </span>
        <a class="badge-author-link" href="{% url dashboard badge.author.username %}">{{ badge.author.username }}</a>
        <a href="{% url dashboard badge.author.username %}">
            <img class="author-icon pull-right" src="{{ badge.author.image_url }}" alt="{{ badge.author.username }}"/>
        </a>
    </div>
</li>

